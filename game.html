<!DOCTYPE html>

<html lang="en">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
		<title></title>
		<script type="text/javascript">
            var requestAnimationFrame;
            (function() {
              requestAnimationFrame = window.requestAnimationFrame || window.mozRequestAnimationFrame ||
                                      window.webkitRequestAnimationFrame || window.msRequestAnimationFrame;
              window.requestAnimationFrame = requestAnimationFrame;
            })();
            var canvas;
            var ctx;
            var playerPosX;
            var playerPosY;
            var triangleSideLength = 20;
            var playerColour = '#ff0000';
            var moveRate = 0;
            var moveSteps = 2;
            var moveAngle = 0;
            var angleSteps = 5;
            var keys = {};
            var player;
            var players = [];


			function init() {
				canvas = document.getElementById('canvas1');
				ctx = canvas.getContext('2d');

                playerPosX = canvas.width / 2;
                playerPosY = canvas.height / 2;

                player = new Triangle();
                console.log(player);

                // when the browser is ready, we'll send it to update()
                requestAnimationFrame(update);
			}


            // refer to these for scrolling viewport
            // http://jsfiddle.net/kmHZt/10/
            // http://jsfiddle.net/hKrrY/
            // http://jsfiddle.net/gfcarv/QKgHs/


            function update() {
                // get stuff from Cody
                if (newPlayers()) {
                     players.push(new Player(name,x,y,angle,colour));
                }


                // display that stuff
                render();
                // once it has been display, display it again if when it's ready
                requestAnimationFrame(update);
            }

            function newPlayers() {
                // check for new players from Cody's server
                return false;
            }

            function Player(name,x,y,angle,colour) {
                this.name = name;
                this.x = x;
                this.y = y;
                this.angle = angle;
                this.colour = colour;
                this.draw = function() {

                }
            }

            function render() {
                ctx.clearRect(0,0,canvas.width,canvas.height);
                ctx.fillRect(0,0,canvas.width,canvas.height);
                ctx.fillStyle = '#cecece';
                ctx.fill();
                player.draw();
                player.update(moveRate,moveAngle);

                for(i=0;i<players.length;i++) {
                    players[i].draw();
                    players[i].update();
                }

            }

            function Triangle() {

                // starting position (could be random from server)
                this.h = triangleSideLength * (Math.sqrt(3)/2);
                this.x = playerPosX;
                this.y = playerPosY;
                this.a = moveAngle;
                // draw the
                this.draw = function() {
                    // save the context where it is
                    ctx.save();
                    // move to the position of the triangle
                    ctx.translate(this.x,this.y);
                    // rotate it based on the keys pressed
                    ctx.rotate(Math.PI / 180 * this.a);
                    // start our drawing of the triangle
                    ctx.beginPath();
                    ctx.moveTo(0,-this.h/2);
                    ctx.lineTo(-triangleSideLength/2, this.h/2);
                    ctx.lineTo(triangleSideLength/2,this.h/2);
                    ctx.lineTo(0,-this.h/2);
                    ctx.closePath();
                    // draw the outline
                    ctx.strokeStyle = playerColour;
                    ctx.stroke();
                    //
                    ctx.beginPath();
                    ctx.arc(0,-this.h/2,2,0,Math.PI*2,false);
                    ctx.fillStyle = playerColour;
                    ctx.fill();
                    ctx.closePath();
                    ctx.restore();
                };
                this.update = function(yMovement,angle) {
                    //
                    playerPosY+= yMovement;
                    this.y += yMovement * Math.cos(angle * Math.PI / 180);
                    this.x -= yMovement * Math.sin(angle * Math.PI / 180);
                    moveRate = 0;
                    this.a = angle;
                };

            }

            function moveTriangle(e) {
                keys[e.which] = true;

                for(var key in keys) {
                    if(key == 37) // left
                        moveAngle -= angleSteps;
                    if(key == 38) // up
                        moveRate = -moveSteps;
                    if(key == 39) // right
                        moveAngle += angleSteps;
                    if(key == 40) // down
                        moveRate = moveSteps;
                }
            }

            function deleteKeys(e) {
                delete keys[e.which];
            }

			window.onload = init;
			
		</script>
	</head>
	<body onkeydown="moveTriangle(event)" onkeyup="deleteKeys(event)">
		<div id="wrap">
			<canvas width="500" height="500" id="canvas1"></canvas>
		</div>
	</body>
</html>